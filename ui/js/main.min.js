/*!
 * Start Bootstrap - SB Admin 2 v4.0.6 ()
 * Copyright 2013-2019 
 * Licensed under  (https://github.com/BlackrockDigital/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

$(document).ready(function(){({init:function(){this.activeTasks=[],this.taskLists=[],this.startGetResults,this.host,this.initEvents(),this.getHost()},initEvents:function(){$("#select_brand").on("change",$.proxy(this.getProfiles,this)),$("#upload_profile").on("change",$.proxy(this.uploadProfile,this)),$("#upload_csv").on("change",$.proxy(this.uploadCsv,this)),$("#upload_payload").on("change",$.proxy(this.uploadPayload,this)),$("#profiles_list").on("change",$.proxy(this.getTaskLists,this)),$("#run_submit").on("click",$.proxy(this.submitTasks,this)),$("#stop_submit").on("click",$.proxy(this.stopTasks,this)),$("#reset_all").on("click",$.proxy(this.resetAll,this)),$("#update_submit").on("click",$.proxy(this.updateRate,this)),$("#task_lists").multiselect({allSelectedText:"All",maxHeight:200,includeSelectAllOption:!0}).multiselect("updateButtonText"),$("#active_task_lists").multiselect({allSelectedText:"All",maxHeight:200,includeSelectAllOption:!0}).multiselect("updateButtonText")},updateDropDowns:function(e,t,s){var a=[];if("multi"===s){for(var o=0;o<t.length;o++)obj=JSON.parse('{"label": "'+t[o]+'", "title": "'+t[o]+'", "value": "'+t[o]+'"}'),a.push(obj);$("#"+e).multiselect("dataprovider",a),$("#"+e).multiselect("rebuild")}else $("#"+e).empty(),$("#"+e).append("<option value=> Select </option>"),$.map(t,function(t){return $("#"+e).append("<option value="+t+">"+t+"</option>")})},getSession:function(){var e=this;$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/getsession",dataType:"json",method:"GET",success:$.proxy(function(t){0<t.length?($("#select_brand").parent().removeClass("d-none"),this.updateDropDowns("select_brand",t[0],"single"),$("#select_brand option[value="+t[0][0]+"]").attr("selected","selected"),$("#select_brand").attr("disabled","disabled"),$("#profiles_list").parent().removeClass("d-none"),this.updateDropDowns("profiles_list",t,"single"),$("#profiles_list option[value="+t[1][0]+"]").attr("selected","selected"),$("#profiles_list").attr("disabled","disabled"),$("#task_lists, #run_submit").parents("li").removeClass("d-none"),this.updateDropDowns("task_lists",t[2],"multi"),$("#active_task_lists, #stop_submit").parents("li").removeClass("d-none"),this.updateDropDowns("active_task_lists",t[2],"multi"),e.getActiveTasks()):e.getBranches()},this)})},getBranches:function(){$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/getbranches",dataType:"json",method:"GET",success:$.proxy(function(t){this.updateDropDowns("select_brand",t,"single"),$("#select_brand").parent().removeClass("d-none")},this)})},getHost:function(){var e=this;$.ajax({url:"http://hudor.perfus.swiggyops.de:8080/api/v1/hudor/gethost",dataType:"json",method:"GET",success:$.proxy(function(t){console.log(t[0]),e.host=t[0],e.getSession()},this)})},getProfiles:function(t){var e=$(t.currentTarget),s=$("#select_brand").val();e.attr("disabled","disabled"),$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/getprofiles",dataType:"json",method:"GET",data:{selectedBranch:s},success:$.proxy(function(t){this.updateDropDowns("profiles_list",t,"single"),$("#upload_profile, #upload_profile_form, #upload_or").parent().removeClass("d-none"),$("#profiles_list").parent().removeClass("d-none")},this)})},refreshProfiles:function(t){$(t.currentTarget);var e=$("#select_brand").val();$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/getprofiles",dataType:"json",method:"GET",data:{selectedBranch:e},success:$.proxy(function(t){this.updateDropDowns("profiles_list",t,"single")},this)})},uploadProfile:function(e){event.preventDefault();var s=this,t=$("#upload_profile_form")[0],a=new FormData(t);$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/upload/task",type:"POST",processData:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1,timeout:6e5,data:a,success:$.proxy(function(t){"200"===t?$("#upload_notify .alert-info").removeClass("d-none"):$("#upload_notify .alert-danger").removeClass("d-none"),setTimeout(function(){$("#upload_notify .alert").addClass("d-none")},5e3),s.refreshProfiles(e)},this)})},uploadCsv:function(t){event.preventDefault();var e=$("#upload_csv_form")[0],s=new FormData(e);$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/upload/csv",type:"POST",processData:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1,timeout:6e5,data:s,success:$.proxy(function(t){"200"===t?$("#upload_notify_csv .alert-info").removeClass("d-none"):$("#upload_notify_csv .alert-danger").removeClass("d-none"),setTimeout(function(){$("#upload_notify_csv .alert").addClass("d-none")},5e3)},this)})},uploadPayload:function(t){event.preventDefault();var e=$("#upload_payload_form")[0],s=new FormData(e);$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/upload/payload",type:"POST",processData:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1,timeout:6e5,data:s,success:$.proxy(function(t){"200"===t?$("#upload_notify_payload .alert-info").removeClass("d-none"):$("#upload_notify_payload .alert-danger").removeClass("d-none"),setTimeout(function(){$("#upload_notify_payload .alert").addClass("d-none")},5e3)},this)})},getTaskLists:function(t){var e=$(t.currentTarget),s=e.val();e.attr("disabled","disabled");var a=this;$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/getalltasks/"+s,dataType:"json",method:"GET",success:$.proxy(function(t){a.getLogs(),$("#upload_profile, #upload_or").parents("li").addClass("d-none"),$("#task_lists, #run_submit").parents("li").removeClass("d-none"),this.updateDropDowns("task_lists",t,"multi"),$("#upload_payload, #upload_payload_form").parent().removeClass("d-none"),$("#upload_csv, #upload_csv_form").parent().removeClass("d-none"),$("#active_task_lists, #stop_submit").parents("li").removeClass("d-none"),this.updateDropDowns("active_task_lists",t,"multi")},this)})},submitTasks:function(t){for(var e=$("#task_lists").val(),s=this,a="",o=0;o<e.length;o++)a=a+e[o]+",";a=a.slice(0,-1),$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/runtask/"+a,dataType:"json",method:"GET",success:$.proxy(function(t){s.getActiveTasks(t)},this)})},stopTasks:function(t){for(var e=$("#active_task_lists").val(),s="",a=0;a<e.length;a++)s=s+e[a]+",";s=s.slice(0,-1),$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/stopTask/"+s,dataType:"json",method:"GET",success:$.proxy(function(t){"200"===t?$("#stop_notify .alert-info").removeClass("d-none"):$("#stop_notify .alert-danger").removeClass("d-none"),setTimeout(function(){$("#stop_notify .alert").addClass("d-none")},5e3)},this)})},updateRate:function(){var t=$("#active_task").val(),e=$("#rate_value").val();$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/updateTaskRate/"+t+"/"+e,dataType:"json",method:"GET",success:$.proxy(function(t){"200"===t?$("#notify .alert-info").removeClass("d-none"):$("#notify .alert-danger").removeClass("d-none"),setTimeout(function(){$("#notify .alert").addClass("d-none")},5e3)},this)})},getActiveTasks:function(){var e=this;$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/getActiveTasks",dataType:"json",method:"GET",success:$.proxy(function(t){console.log(t),$("#active_task").parents("li").removeClass("d-none"),this.updateDropDowns("active_task",t,"single"),$("#update_block").removeClass("d-none"),0<t.length?(e.getTasksResults(),this.startGetResults=setInterval(function(){e.getTasksResults(t),e.getLogs()},1e4)):(console.log("clearning results"),clearInterval(this.startGetResults))},this)})},getLogs:function(){$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/logs",dataType:"json",method:"GET",success:$.proxy(function(t){if(0<t.length){var e=$("#logs").val();$("#logs").html(e+t.toString())}},this)})},getTasksResults:function(t){$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/getresults",dataType:"json",method:"GET",success:$.proxy(function(t){0<t.length?this.paintResults(t):($("#results_card").empty(),clearInterval(this.startGetResults))},this)})},paintResults:function(t){var e=this,s=$("#results_card");s.empty(),setTimeout($.proxy(function(){t.forEach(function(t){t=JSON.parse(t),s.append(e.getMarkUp(t))})},this),500),$("#empty_search").addClass("d-none"),s.removeClass("d-none")},getSelectedArray:function(){},getMarkUp:function(t){return'<div class="col-md-6 col-xl-3 mb-4"><div class="border-left-primary card h-100 py-2 shadow"><div class=card-body><div class="align-items-center no-gutters row"><div class="col mr-2 text-center"><div class="font-weight-bold h5 mb-1 text-primary text-sm text-uppercase">'+t.title+'</div><br></div></div><div class="align-items-center no-gutters row"><div class="col mr-2 text-center"><div class="font-weight-bold mb-1 text-sm text-uppercase text-success">Success</div><div class="font-weight-bold h5 mb-0 text-gray-800">'+t.success+'</div></div><div class="col mr-2 text-center"><div class="font-weight-bold mb-1 text-sm text-uppercase text-warning">Rate</div><div class="font-weight-bold h5 mb-0 text-gray-800">'+t.rate+'</div></div><div class="col mr-2 text-center"><div class="font-weight-bold mb-1 text-sm text-uppercase text-danger">ERROR</div><div class="font-weight-bold h5 mb-0 text-gray-800">'+t.error+"</div></div></div></div></div></div>"},resetAll:function(){$.ajax({url:"http://"+this.host+":8080/api/v1/hudor/reset",dataType:"json",method:"GET",success:$.proxy(function(t){clearInterval(this.startGetResults),location.reload("forcedReload")},this)})}}).init()});